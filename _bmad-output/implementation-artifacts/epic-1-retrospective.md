# Epic 1 Retrospective: Common Infrastructure

**Date:** 2025-12-30
**Facilitator:** Bob (Scrum Master)
**Participants:** moonklabs, Alice (PO), Charlie (Senior Dev), Dana (QA)

---

## Executive Summary

Epic 1 (Common Infrastructure)이 성공적으로 완료되었습니다. 9개 스토리 모두 완료, 400개 테스트 통과, 38건의 코드 리뷰 이슈가 모두 수정되었습니다.

**핵심 성과:**
- packages/common 패키지 완성 (@moonklabs/mcp-common)
- ESM/CJS 듀얼 빌드 지원
- 7개 핵심 모듈 구현 (types, errors, config, logger, cache, metrics, testing)

---

## Delivery Metrics

| 메트릭 | 값 |
|--------|-----|
| 완료 스토리 | 9/9 (100%) |
| 총 테스트 | 400개 |
| 코드 리뷰 이슈 | 38건 (모두 수정) |
| HIGH 이슈 | 4건 |
| MEDIUM 이슈 | 20건 |
| 기술 부채 | 0건 |

---

## Module Summary

| 모듈 | 스토리 | 테스트 | 핵심 기능 |
|------|--------|--------|-----------|
| types | 1.2 | 55개 | McpResponse, McpErrorResponse, CacheKey |
| errors | 1.3 | 27개 | createMcpError, ERROR_CODES |
| config | 1.4 | 30개 | loadEnvConfig, Zod 스키마 |
| logger | 1.5 | 23개 | createLogger, 민감정보 마스킹 |
| cache | 1.6 | 51개 | CacheManager, buildCacheKey |
| metrics | 1.7 | 49개 | MetricsCollector, 성공률/히트율 |
| testing | 1.8 | 61개 | mockNotionPage, assertMcpSuccess |

---

## What Went Well

### 1. 코드 리뷰의 효과성

코드 리뷰가 매우 효과적이었습니다. 총 38건의 이슈가 발견되어 수정되었습니다.

| 스토리 | 리뷰 이슈 | 핵심 발견 |
|--------|----------|----------|
| 1.1 | 4건 | NodeNext `.js` 확장자 누락 (HIGH) |
| 1.2 | 6건 | 타입 가드 null 처리 |
| 1.3 | 4건 | ErrorCode 타입 동기화 |
| 1.4 | 4건 | 캐싱 패턴, TTL 범위 검증 |
| 1.5 | 2건 | serverName 검증, 마스킹 패턴 |
| 1.7 | 4건 | 메모리 누수 (HIGH) - 배열 → 집계값 |
| 1.8 | 5건 | vitest 의존성 문서화, edge case |
| 1.9 | 5건 | Git hooks, Breaking Changes 섹션 |

**Early catch, project-wide fix:** Story 1.1에서 발견한 `.js` 확장자 규칙이 이후 모든 스토리에 적용됨.

### 2. TDD 패턴 적용

RED-GREEN-REFACTOR 사이클로 안정적인 구현. 테스트가 점진적으로 증가:
- Story 1.1: 3개
- Story 1.9: 400개

### 3. 3계층 분리 패턴의 일관성

```
index.ts → tool.ts → toolLogic.ts
```

모든 모듈에서 동일 패턴 적용. 순수 함수 분리로 테스트 용이성 확보.

### 4. Previous Story Learnings 문서화

각 스토리에서 배운 교훈을 다음 스토리에 전파하는 패턴이 효과적이었음.

---

## Lessons Learned

### 1. NodeNext 모듈 해석 규칙

```typescript
// ✅ 올바른 import
import { createMcpError } from './createMcpError.js';

// ❌ 컴파일 에러
import { createMcpError } from './createMcpError';
```

### 2. 코드 리뷰의 파급 효과

- Story 1.1에서 발견 → 이후 8개 스토리에 일관 적용
- "한 번 배운 교훈을 Previous Story Learnings 섹션에 문서화"

### 3. 메모리 효율성 고려

Story 1.7에서 배열이 무한 증가하는 메모리 누수 발견:
- **Before:** `durations: number[]` 배열에 계속 push
- **After:** `totalDuration`, `count` 집계값으로 변경 → O(1) 메모리

### 4. 입력 검증 패턴

```typescript
const trimmedName = serverName.trim();
if (!trimmedName) {
  throw new Error('serverName은 비어있을 수 없습니다');
}
```

---

## Areas for Improvement

1. **Story 1.6 코드 리뷰 미완료** - 스토리 파일에 "코드 리뷰 완료" 체크박스가 비어있음
2. **일부 스토리에서 테스트 후 추가** - TDD가 아닌 구현 후 테스트 케이스가 일부 있었음

---

## Impact on Next Epic

packages/common이 완성되어 Epic 2 (mcp-context-loader)가 바로 사용 가능:

| Epic 1 산출물 | Epic 2 활용 |
|--------------|-------------|
| `createMcpError` | 에러 응답 일관성 |
| `CacheManager` | Notion API Rate Limit 회피 |
| `createLogger` | 민감정보 마스킹 로깅 |
| `MetricsCollector` | 도구 호출 통계 |
| `mockNotionPage` | 통합 테스트 |
| `assertMcpSuccess` | MCP 응답 검증 |

---

## Action Items for Epic 2

1. **`.js` 확장자 규칙 계속 적용** - NodeNext 모듈 해석
2. **모든 스토리에서 코드 리뷰 완료 체크** - Story 1.6처럼 빠지지 않도록
3. **Previous Story Learnings 활용** - 각 스토리에 이전 교훈 섹션 유지
4. **TDD 더 엄격하게** - RED 단계를 더 철저히

---

## Team Feedback

**moonklabs (User):** "코드 리뷰가 효과적이었어요"

**Alice (PO):** "숫자가 인상적. 9개 스토리, 400개 테스트, 38건의 코드 리뷰 이슈 모두 수정."

**Charlie (Senior Dev):** "코드 리뷰에서 발견된 HIGH 이슈 4건이 특히 중요했어요. Story 1.7의 메모리 누수 문제를 잡아냈죠."

**Dana (QA Engineer):** "테스트가 스토리마다 계속 늘어난 것도 좋았어요. 3개에서 시작해서 400개까지."

---

## Conclusion

Epic 1은 성공적으로 완료되었습니다. 코드 리뷰의 효과성이 특히 돋보였으며, 발견된 패턴과 교훈들이 다음 Epic에 전파될 준비가 되었습니다.

**Next Step:** Epic 2 (mcp-context-loader) - Story 2.6 통합 테스트 구현

---

_Retrospective completed: 2025-12-30_
_Facilitator: Bob (Scrum Master)_
_Generated by: BMM Retrospective Workflow_
